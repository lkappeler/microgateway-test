# API Connect Toolkit logger

## Basic usage

The logger supports the following levels:
  * debug
  * info
  * warning
  * error (or severe)
  * fatal

They are exposed as methods on the logger object and can be used as `logger.info(...)` etc.

## Default Logging Streams

By default, logs are streamed to the console and to `$APIC_CONFIG_PATH/apic.log`. If `$APIC_CONFIG_PATH` is not set, it is logged to `~/.apiconnect/apic.log`.

The console logging stream is prettified by the formatter stream in `lib/formatter.js`. To change the logging level of the console stream, you can set `LOG_LEVEL`.

The file logging stream consists of raw JSON logs. To see it in a readable format, you can run `cat ~/.apiconnect/apic.log | bunyan`. To change the logging level of the file stream, you can set `FILE_LOG_LEVEL`.

## Configuring the logger

The logger can be customized with [environment variables](#environment-variables) or a configuration file.  The logger will look for a custom configuration file defined by `APIC_LOG_CONFIG_FILE`. If it does not exist, it looks in the default configuration directory: `~/.apiconnect/logger-config.js`.  The configuration file can be JSON or JS (.json/.js).

The default configuration is merged with user specified configuration, but the user specified configuration takes precedence. Default streams (stdout/file logger) cannot be replaced.

### Supported Configuration

The configuration file is JSON based. You can configure the `bunyan` logger as well as the default bunyan `filelogger` stream.

`bunyan`:
Refer to [bunyan README](https://github.com/trentm/node-bunyan).

`filelogger`:

| key      | default                | description                                                                                                        |
|----------|------------------------|--------------------------------------------------------------------------------------------------------------------|
| size     | 50m                    | The max file size of a log before rotation occurs. Supports 1024, 1k, 1m, 1g                                       |
| keep     | 10                     | The number of rotated log files to keep (including the primary log file). Additional logs are deleted no rotation. |
| file     | ~/.apiconnect/apic.log | The file log file to write data to.                                                                                |
| compress | false                  | Optionally compress rotated files with gzip.                                                                       |

### Sample Config

Sample JSON config file (.json):
```
{
  "bunyan": {
    "name": "custom logger",
    "src": "false",
    "streams": [{
      "level": "debug",
      "type": "file",
      "path": "custom_file.log"
    }]
  },
  "filelogger": {
    "size": "1K",
    "file": "custom.log",
    "keep": 5
  }
}
```

Sample JS config file (.js):
```
module.exports =
{
  bunyan: {
    name: 'userConnect',
    streams: [{
      level: 'debug',
      type: 'file',
      path: 'custom_file.log'
    }]
  },
  filelogger: {
    file: 'custom.log',
    size: '50M',
    keep: 10
  }
};

```
_Note: If you have both `logger-config.json` and `logger-config.js`, the JSON file takes priority._

## Console Output

The logger provides two methods to write to console `logger.writeln` and `logger.write`.
Both these methods will write to stdout and log output to the log file.

## Flushing logs

The logger provides `logger.flush()` and `logger.exit(exitCode)` methods which should be called before the CLI exits in
order to ensure that all logs are written to disk. Both methods return a Promise object.

## Environment variables

- `LOG_LEVEL` specifies the lowest level of messages logged to the console stream.
 - deprecated `APIC_LOG_CONSOLE_LEVEL`
- `FILE_LOG_LEVEL` specifies the lowest level of messages logged to the `apic.log` log file.
 - deprecated `APIC_LOG_FILE_LEVEL`
- `APIC_CONFIG_PATH` specifies the directory path containing the system logging configuration file `logger-config.json`.
- `APIC_LOG_CONFIG_FILE` specifies the path of the user-level logging configuration.
