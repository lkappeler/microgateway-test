// Copyright IBM Corp. 2015,2016. All Rights Reserved.
// Node module: wlpn-password
// US Government Users Restricted Rights - Use, duplication or disclosure
// restricted by GSA ADP Schedule Contract with IBM Corp.

'use strict';

var XOR_MASK = 0x5F;

exports.encode = encode;
exports.decode = decode;

function encode(input) {
  var xorBytes = xor(input);
  var buffer = new Buffer(xorBytes);
  var result = buffer.toString('base64');
  return '{xor}' + result;
}

function decode(input) {
  if (input.substring(0, 5) === '{xor}') {
    input = input.substr(5);
    var decodedBuffer = new Buffer(input, 'base64');
    var xorArr = xor(decodedBuffer.toString('ascii'));
    var xorBuffer = new Buffer(xorArr);
    return xorBuffer.toString('ascii');
  } else {
    return input;
  }
}

function xor(string) {
  var xorBytes = [];
  if (string) {
    for (var i = 0; i < string.length; i++) {
      xorBytes[i] = string.charCodeAt(i) ^ XOR_MASK;
    }
  }
  return xorBytes;
}
